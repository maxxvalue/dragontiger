<?php
$table="potakdb";	//р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Хр╕▒р╕зр╣Бр╕Ыр╕г
$max=200;
$access_token = '4YlJlgw/oJC3ik03YOZ1RFUBrmTI8UvdlTnXLZ/bC6qyZk7nrEUWkExCHYyIss7CU8ZKk14baE6yh282T7SpO/4tPQDLs3BcBa0OcZkewK2i6N1sGbuZXmFoXwyOrLz7oyeblwRhqsdkTNn2wbkZxQdB04t89/1O/w1cDnyilFU=';

$content = file_get_contents('php://input');		//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Ир╕▓р╕Бр╕ер╣Ир╕нр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Щ line
$events = json_decode($content, true);			//р╣Бр╕Бр╣Йр╕гр╕░р╕лр╕▒р╕к json р╕Чр╕╡р╣И line р╕кр╣Ир╕Зр╕бр╕▓
require('function.php');				//р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╣Ир╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
if (!is_null($events['events'])) {			//р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╣Ир╕Зр╕бр╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
	foreach ($events['events'] as $event) {		//р╕зр╕Щр╕ер╕╣р╕Ыр╣Гр╕Щ array р╕Чр╕╡р╕ер╕░р╕Хр╕▒р╕з
		$replyToken = $event['replyToken'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓  replyToken р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕нр╕кр╣Ир╕Зр╕Бр╕ер╕▒р╕Ъ
		$text=$event['message']['text'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г text
		$type=$event['message']['type'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ type
		$arr2=explode(" ",$text);					//р╣Бр╕вр╕Бр╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕Ьр╕е
		$text=clear($text);					//р╕Бр╕│р╕Ир╕▒р╕Фр╣Ар╕зр╣Йр╕Щр╕зр╕гр╕гр╕Др╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Ар╕нр╣Зр╕Щр╣Ар╕Хр╕нр╕гр╣М
		$lineid=$event['source']['userId'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ userId р╕Ир╕▓р╕Бр╣Др╕ер╕Щр╣Мр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г lineid
		$groupid=$event['source']['groupId'];//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ groupId р╕Ир╕▓р╕Бр╣Др╕ер╕Щр╣Мр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г groupid
		$wrong=" р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕Чр╕Зр╕Ьр╕┤р╕ФтЭМ";							//р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Цр╣Йр╕▓р╣Ар╕Бр╕┤р╕Щр╕Юр╕┤р╕бр╕Юр╣Мр╕Юр╕Щр╕▒р╕Щр╕Ьр╕┤р╕Ф
		
		$url='https://api.line.me/v2/bot/profile/'.$lineid;	//р╕Бр╕│р╕лр╕Щр╕Ф url р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╣Ир╕Зр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile
		$headers=array('Authorization: Bearer ' . $access_token);//р╕Бр╕│р╕лр╕Щр╕Ф headers р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile
		$ch = curl_init($url);					//р╣Ар╕гр╕┤р╣Ир╕б curl
		curl_setopt($ch, CURLOPT_RETURNTRANSFER,TRUE);		//р╕Ыр╕гр╕▒р╕Ър╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);		//р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ headers
		$result = curl_exec($ch);				//р╕кр╣Ир╕Зр╕Др╣Ир╕▓р╣Др╕Ыр╣Гр╕лр╣Йр╣Др╕ер╕Щр╣Мр╣Бр╕ер╕░р╕гр╕▒р╕Ър╕Бр╕ер╕▒р╕Ър╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╣Бр╕Ыр╕г result
		$res=json_decode($result,true);				//р╣Бр╕Бр╣Й json р╣Ар╕Ыр╣Зр╕Щ array
		if($res['userId']==''){
			$url='https://api.line.me/v2/bot/group/'.$groupid.'/member/'.$lineid;	//р╕Бр╕│р╕лр╕Щр╕Ф url р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╣Ир╕Зр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile р╣Бр╕Ър╕Ъ group
			$headers=array('Authorization: Bearer ' . $access_token);//р╕Бр╕│р╕лр╕Щр╕Ф headers р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile
			$ch = curl_init($url);					//р╣Ар╕гр╕┤р╣Ир╕б curl
			curl_setopt($ch, CURLOPT_RETURNTRANSFER,TRUE);		//р╕Ыр╕гр╕▒р╕Ър╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
			curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);		//р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ headers
			$result = curl_exec($ch);				//р╕кр╣Ир╕Зр╕Др╣Ир╕▓р╣Др╕Ыр╣Гр╕лр╣Йр╣Др╕ер╕Щр╣Мр╣Бр╕ер╕░р╕гр╕▒р╕Ър╕Бр╕ер╕▒р╕Ър╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╣Бр╕Ыр╕г result
			$res=json_decode($result,true);				//р╣Бр╕Бр╣Й json р╣Ар╕Ыр╣Зр╕Щ array
		}
		$id=getid($lineid,$table);					//р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╣Ир╕Щ р╣Ар╕Юр╕╖р╣Ир╕нр╕лр╕▓ id р╕Ир╕▓р╕Б lineid
		$netid=getid($lineid,'money');		//р╕гр╕▒р╕Ъ id р╕Др╣Ир╕▓р╣Ар╕Зр╕┤р╕Щ
		$net=select($netid,'money','NET');	//р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
		$status=select(1,$table,"status");	//р╕кр╕Цр╕▓р╕Щр╕░р╕гр╕нр╕Ъ
		$lap=select(1,$table,"NET");	//р╕Ир╕│р╕Щр╕зр╕Щр╕гр╕нр╕Ъ
		$sarop=select(1,$table,"admin");	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕зр╣Ир╕▓р╕кр╕гр╕╕р╕Ыр╕вр╕▒р╕З
		$poll=select(1,$table,'LineID');		//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Ьр╕ер╕Бр╕▓р╕гр╕кр╕гр╕╕р╕Ы
		$bet=select(1,$table,'play');	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╣Ар╕Зр╕┤р╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕Вр╕▓
		$arr=str_split($text);						//р╣Бр╕вр╕Бр╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕бр╕▓р╕Чр╕╡р╕ер╕░р╕Хр╕▒р╕зр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щ arr
		//р╕Хр╕▒р╕з t р╕Щр╕│р╕лр╕Щр╣Йр╕▓р╣Бр╕Ыр╕ер╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Бр╕Чр╕З
		$ottf=array(1,2,3,4);
		//р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Гр╕лр╣Йр╕Ър╕нр╕Чр╣Бр╕Ир╣Йр╕З р╕зр╣Ир╕▓р╣Гр╕лр╣Йр╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕Бр╣Ир╕нр╕Щ
		if(($arr[0]=="t"||$arr[0]=="T")&&$status==1&&$id==0){
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕Бр╕гр╕╕р╕Ур╕▓р╕Юр╕┤р╕б play";
		}
		elseif(($arr[0]=="t"||$arr[0]=="T")&&$status==1){
			$sum=sum($id,$table);
			$i=0;
			$all=0;
			$btext=substr($text,1);
			$barr=str_split($btext);
			foreach($barr as $v){
				if(!in_array($v,$ottf)){
					$i=1;
				}
				else{
					$all++;
				}
			}
			if($net<($all*$bet)){
				$replytext="тЭМр╕Др╕╕р╕У ".$res['displayName']." р╕бр╕╡р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н $net р╕Ър╕▓р╕ЧтЭМ";
			}
			elseif($i==1){
				$replytext="тЭМр╕Др╕╕р╕У ".$res['displayName'].$wrong;
			}
			else{
				if($sum!=0){
					clearpotak($id);
				}
				foreach($ottf as $v){
					if($barr[0]==$v||$barr[1]==$v||$barr[2]==$v||$barr[3]==$v){
						update($id,$table,'P'.$v,1);
						update($id,$table,'play',1);
					}
				}
				updatepotak();
				$var=bresult();
				$p1=$var[0];
				$p2=$var[1];
				$p3=$var[2];
				$p4=$var[3];
				if($sum==0){
					$replytext="тЮбя╕Пр╕Др╕╕р╕У ".$res['displayName']." р╣Бр╕Чр╕Зр╕Вр╕▓ $btext р╕Вр╕▓р╕ер╕░ $bet р╕Ър╕▓р╕Ч р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н $net р╕Ър╕▓р╕Ч
1-$p1 | 2-$p2 | 3-$p3 | 4-$p4";
				}
				else{
					$replytext="ЁЯФАр╕Др╕╕р╕У ".$res['displayName']." р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Чр╕Зр╕Вр╕▓ $btext р╕Вр╕▓р╕ер╕░ $bet р╕Ър╕▓р╕Ч р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н $net р╕Ър╕▓р╕Ч
1-$p1 | 2-$p2 | 3-$p3 | 4-$p4";
				}
			}
		}
		elseif(($arr[0]=="t"||$arr[0]=="T")&&$status==0){
			$replytext="тЭМр╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╣Бр╕ер╣Йр╕зтЭМ";
		}
		//check р╕Хр╕▒р╕зр╕Чр╕╡р╣Ир╣Бр╕Чр╕З
		if($text=='check'||$text=='Check'){
			$replytext=check($id,$bet,$net);
		}
		//check р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
		if($text=='@id'){
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ $net р╕Ър╕▓р╕Ч";
		}
		//р╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕Йр╕Юр╕▓р╕░ admin
		if(select($id,$table,"admin")==1){
			//р╕Цр╣Йр╕▓р╕Юр╕┤р╕бр╕бр╕▓р╕зр╣Ир╕▓ р╕Ыр╕гр╕▒р╕Ъ р╣Гр╕лр╣Йр╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕Кр╕╖р╣Ир╕нр╕Чр╕╕р╕Бр╕Др╕Щ
			if($text=="р╕Ыр╕гр╕▒р╕Ъ"){								
				config($access_token,$groupid,$table);
				$replytext="р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕Кр╕╖р╣Ир╕нр╕кр╕│р╣Ар╕гр╣Зр╕И";
			}
			//р╣Ар╕Ыр╕┤р╕Фр╕гр╕нр╕Ъ р╣Гр╕Кр╣Йр╕Кр╣Ир╕нр╕З net р╣Ар╕Ыр╣Зр╕Щр╕Кр╣Ир╕нр╕Зр╕Щр╕▒р╕Ър╕гр╕нр╕Ъ
			if($type=="sticker"&&$status==0){
				if($sarop==0){
					$manymessage=2;
					update(1,$table,"status",1);
					update(1,$table,"admin",1);
					$replytext1='тЩая╕ПтЩея╕Пр╕Бр╕Хр╕┤р╕Бр╕▓р╣Вр╕Ыр╣Кр╕░р╣Бр╕Хр╕БтЩжя╕ПтЩгя╕П
┬оя╕Пр╕Юр╕┤р╕бр╕Юр╣М play р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕Бр╣Ир╕нр╕Щ┬оя╕П
р╕Юр╕┤р╕бр╕Юр╣М t р╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕Вр╕▓р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Бр╕Чр╕З р╣Вр╕Фр╕вр╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕╡р╣Ир╕ер╕Зр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕Вр╕▓р╕Ир╕░р╕Цр╕╣р╕Бр╕Бр╕│р╕лр╕Щр╕Фр╣Др╕зр╣Йр╣Вр╕Фр╕вр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕Фр╕▒р╕Зр╕Щр╕▒р╣Йр╕Щр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Гр╕кр╣Ир╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ
р╕Вр╕▓р╣Гр╕Фр╕бр╕╡р╣Бр╕Хр╣Йр╕бр╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╕Ир╕░р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щр╣Бр╕Чр╕Зр╕Ир╕▓р╕Бр╕Вр╕▓р╕нр╕╖р╣Ир╕Щ р╣Ж р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Цр╣Йр╕▓р╣Бр╕Чр╕Зр╕Цр╕╣р╕Б 2 р╕Др╕Щ р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╕Щр╕ер╕░р╕Др╕гр╕╢р╣Ир╕З)';
					$replytext2="р╣Ар╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╕Чр╕╡р╣И ".$lap;
				}
				else{
					$replytext='тЭМр╕Бр╕гр╕╕р╕Ур╕▓р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Бр╣Ир╕нр╕ЩтЭМ';
				}
			}
			//р╕Ыр╕┤р╕Фр╕гр╕нр╕Ъ
			if($type=="sticker"&&$status==1){
				$manymessage=2;
				update(1,$table,"status",0);
				$replytext1='тЩая╕ПтЩея╕Пр╕Бр╕Хр╕┤р╕Бр╕▓р╣Вр╕Ыр╣Кр╕░р╣Бр╕Хр╕БтЩжя╕ПтЩгя╕П
┬оя╕Пр╕Юр╕┤р╕бр╕Юр╣М play р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕Бр╣Ир╕нр╕Щ┬оя╕П
р╕Юр╕┤р╕бр╕Юр╣М t р╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕Вр╕▓р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Бр╕Чр╕З р╣Вр╕Фр╕вр╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕╡р╣Ир╕ер╕Зр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕Вр╕▓р╕Ир╕░р╕Цр╕╣р╕Бр╕Бр╕│р╕лр╕Щр╕Фр╣Др╕зр╣Йр╣Вр╕Фр╕вр╣Бр╕нр╕Фр╕бр╕┤р╕Щр╕Фр╕▒р╕Зр╕Щр╕▒р╣Йр╕Щр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Гр╕кр╣Ир╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ
р╕Вр╕▓р╣Гр╕Фр╕бр╕╡р╣Бр╕Хр╣Йр╕бр╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╕Ир╕░р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щр╣Бр╕Чр╕Зр╕Ир╕▓р╕Бр╕Вр╕▓р╕нр╕╖р╣Ир╕Щ р╣Ж р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Цр╣Йр╕▓р╣Бр╕Чр╕Зр╕Цр╕╣р╕Б 2 р╕Др╕Щ р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╕Щр╕ер╕░р╕Др╕гр╕╢р╣Ир╕З)';
				$replytext2="р╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╕Чр╕╡р╣И ".$lap;
			}
			//р╣Ар╕Лр╣Зр╕Хр╕гр╕нр╕Ър╣Бр╕гр╕Б
			if($text=="op"||$text=="Op"){
				update(1,$table,"status",0);
				update(1,$table,"NET",1);
				update(1,$table,'admin',0);
				$replytext="р╣Ар╕Хр╕гр╕╡р╕вр╕бр╣Ар╕гр╕┤р╣Ир╕бр╕гр╕нр╕Ър╣Бр╕гр╕Б";
			}
			
			//р╕Ыр╕гр╕▒р╕Ър╕зр╣Ир╕▓р╕ер╕Зр╕Хр╕▓р╕ер╕░р╣Ар╕Чр╣Ир╕▓р╣Др╕лр╕гр╣И
			if($arr2[0]=='р╕Вр╕▓р╕ер╕░'&&$status==0){
				update(1,$table,'play',$arr2[1]);
				$replytext="р╕Ыр╕гр╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╣Бр╕Чр╕Зр╕Вр╕▓р╕ер╕░ $arr2[1] р╕Ър╕▓р╕Ч";
			}
			//р╕Ыр╕гр╕▒р╕Ър╕зр╣Ир╕▓р╕лр╕▒р╕Бр╕Бр╕╡р╣И%
			if($arr2[0]=='%'){
				update(1,$table,'vat',$arr2[1]);
				$replytext="р╕Ыр╕гр╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╕лр╕▒р╕Б $arr2[1]%";
			}
			
			//р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Хр╕нр╕Щр╕Ир╕Ър╕гр╕нр╕Ъ
			if(($arr[0]=="s"||$arr[0]=="S")&&$status==0){
				$replytext="р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕кр╕гр╕╕р╕Ы р╕Вр╕▓ $arr[1] р╕бр╕╡р╣Бр╕Хр╣Йр╕бр╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╕лр╕гр╕╖р╕нр╣Др╕бр╣ИтЭУ";
				update(1,$table,'LineID',$arr[1]);
			}
			elseif(($arr[0]=="s"||$arr[0]=="S")&&$status==1){
				$replytext='тЭМр╕Бр╕гр╕╕р╕Ур╕▓р╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╕Бр╣Ир╕нр╕ЩтЭМ';
			}
			//р╕вр╕╖р╕Щр╕вр╕▒р╕Щ
			if($text=="@ok"&&$poll!=0){
				if(in_array($poll,$ottf)){
					update($id,$table,'NET',$net);
					$replytext=resultpotak($poll);
					update($netid,'money','NET',select($id,$table,'NET'));
					update(1,$table,'LineID',0);
					update(1,$table,'admin',0);
					update(1,$table,"NET",$lap+1);
				}
				else{
					$replytext='тЭМр╕кр╕гр╕╕р╕Ыр╕Ьр╕┤р╕Ф р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╕гр╕╕р╕Ыр╣Гр╕лр╕бр╣ИтЭМ';
				}
			}
		}
		//р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щ
		if(($text=="play"||$text=="Play")&&$id==0){
			$var=codename($res['displayName']);
			insert($table,$var,$lineid,0);
			if($netid==0){
				insert('money',$var,$lineid,1000);
			}
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Бр╕ер╣Йр╕з";
		}
		//р╕Цр╣Йр╕▓р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Бр╕ер╣Йр╕зр╕Бр╣Зр╣Гр╕лр╣Йр╕Ър╕нр╕Бр╕зр╣Ир╕▓р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕ер╣Ир╕Щ
		elseif(($text=="play"||$text=="Play")&&$id!=0){
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕ер╣Ир╕Щр╣Бр╕ер╣Йр╕з";
		}
		
		//р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$messages = [
			[
			'type' => 'text',
			'text' => $replytext
			]
		];
		if($manymessage==2){
			$messages = [
				[
				'type' => 'text',
				'text' => $replytext1
				],
				[
				'type' => 'text',
				'text' => $replytext2
				]
			];
		}
		$url = 'https://api.line.me/v2/bot/message/reply';		//url р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$data = [
			'replyToken' => $replyToken,				//replayToken р╣Гр╕кр╣Ир╕Хр╕гр╕Зр╕Щр╕╡р╣Й
			'messages' => $messages,
		];
		$post = json_encode($data);						//web р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$headers = array('Content-Type: application/json', 'Authorization: Bearer ' . $access_token);
														//headers р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$ch = curl_init($url);							//р╣Ар╕гр╕┤р╣Ир╕б curl 
		curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");//р╕Ыр╕гр╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ъ post
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);	
		curl_setopt($ch, CURLOPT_POSTFIELDS, $post);	//р╣Гр╕кр╣Ир╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕Ир╕░р╕кр╣Ир╕З
		curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);	//р╕кр╣Ир╕З header
		curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);	
		curl_exec($ch);									//р╕кр╣Ир╕Зр╣Др╕Ыр╣Гр╕лр╣Йр╣Др╕ер╕Щр╣Мр╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
	}
}
