<?php
$table="dragontigerdb";	//р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Хр╕▒р╕зр╣Бр╕Ыр╕г
$max=200;
$access_token = 'SIkXpp6ylNgQ42HEg2wkOD9hG7YRkzHbsORCxZ3p9iWLynhB9/t7hD9zdoMdUbXYqaibnclBOqZUfj+jLpWyuwWRGpvWd2hMaZvRf+2LyXbbRi9SDZrlRfGcWm6w3ry+fatBxeFmvx4S0zjEzvvFFAdB04t89/1O/w1cDnyilFU=';

$content = file_get_contents('php://input');		//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Ир╕▓р╕Бр╕ер╣Ир╕нр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Щ line
$events = json_decode($content, true);			//р╣Бр╕Бр╣Йр╕гр╕░р╕лр╕▒р╕к json р╕Чр╕╡р╣И line р╕кр╣Ир╕Зр╕бр╕▓
require('function.php');				//р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╣Ир╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
if (!is_null($events['events'])) {			//р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╣Ир╕Зр╕бр╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
	foreach ($events['events'] as $event) {		//р╕зр╕Щр╕ер╕╣р╕Ыр╣Гр╕Щ array р╕Чр╕╡р╕ер╕░р╕Хр╕▒р╕з
		$replyToken = $event['replyToken'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓  replyToken р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕нр╕кр╣Ир╕Зр╕Бр╕ер╕▒р╕Ъ
		$text=$event['message']['text'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г text
		$type=$event['message']['type'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ type
		$text=clear($text);					//р╕Бр╕│р╕Ир╕▒р╕Фр╣Ар╕зр╣Йр╕Щр╕зр╕гр╕гр╕Др╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Ар╕нр╣Зр╕Щр╣Ар╕Хр╕нр╕гр╣М
		$lineid=$event['source']['userId'];	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ userId р╕Ир╕▓р╕Бр╣Др╕ер╕Щр╣Мр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г lineid
		$groupid=$event['source']['groupId'];//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ groupId р╕Ир╕▓р╕Бр╣Др╕ер╕Щр╣Мр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щр╕Хр╕▒р╕зр╣Бр╕Ыр╕г groupid
		$wrong=" тЭМр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕Чр╕Зр╕Ьр╕┤р╕ФтЭМ";							//р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Цр╣Йр╕▓р╣Ар╕Бр╕┤р╕Щр╕Юр╕┤р╕бр╕Юр╣Мр╕Юр╕Щр╕▒р╕Щр╕Ьр╕┤р╕Ф
		
		$url='https://api.line.me/v2/bot/profile/'.$lineid;	//р╕Бр╕│р╕лр╕Щр╕Ф url р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╣Ир╕Зр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile
		$headers=array('Authorization: Bearer ' . $access_token);//р╕Бр╕│р╕лр╕Щр╕Ф headers р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile
		$ch = curl_init($url);					//р╣Ар╕гр╕┤р╣Ир╕б curl
		curl_setopt($ch, CURLOPT_RETURNTRANSFER,TRUE);		//р╕Ыр╕гр╕▒р╕Ър╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);		//р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ headers
		//curl_setopt($ch, CURLOPT_PROXY, $proxy);			//р╕Хр╕▒р╣Йр╕Зр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
		//curl_setopt($ch, CURLOPT_PROXYUSERPWD, $proxyauth);
		$result = curl_exec($ch);				//р╕кр╣Ир╕Зр╕Др╣Ир╕▓р╣Др╕Ыр╣Гр╕лр╣Йр╣Др╕ер╕Щр╣Мр╣Бр╕ер╕░р╕гр╕▒р╕Ър╕Бр╕ер╕▒р╕Ър╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╣Бр╕Ыр╕г result
		$res=json_decode($result,true);				//р╣Бр╕Бр╣Й json р╣Ар╕Ыр╣Зр╕Щ array
		if($res['userId']==''){
			$url='https://api.line.me/v2/bot/group/'.$groupid.'/member/'.$lineid;	//р╕Бр╕│р╕лр╕Щр╕Ф url р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╣Ир╕Зр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile р╣Бр╕Ър╕Ъ group
			$headers=array('Authorization: Bearer ' . $access_token);//р╕Бр╕│р╕лр╕Щр╕Ф headers р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▒р╕Ър╕Др╣Ир╕▓ profile
			$ch = curl_init($url);					//р╣Ар╕гр╕┤р╣Ир╕б curl
			curl_setopt($ch, CURLOPT_RETURNTRANSFER,TRUE);		//р╕Ыр╕гр╕▒р╕Ър╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
			curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);		//р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ headers
			//curl_setopt($ch, CURLOPT_PROXY, $proxy);			//р╕Хр╕▒р╣Йр╕Зр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
			//curl_setopt($ch, CURLOPT_PROXYUSERPWD, $proxyauth);
			$result = curl_exec($ch);				//р╕кр╣Ир╕Зр╕Др╣Ир╕▓р╣Др╕Ыр╣Гр╕лр╣Йр╣Др╕ер╕Щр╣Мр╣Бр╕ер╕░р╕гр╕▒р╕Ър╕Бр╕ер╕▒р╕Ър╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╣Бр╕Ыр╕г result
			$res=json_decode($result,true);				//р╣Бр╕Бр╣Й json р╣Ар╕Ыр╣Зр╕Щ array
		}
		$id=getid($lineid,$table);					//р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╣Ир╕Щ р╣Ар╕Юр╕╖р╣Ир╕нр╕лр╕▓ id р╕Ир╕▓р╕Б lineid
		$netid=getid($lineid,'money');		//р╕гр╕▒р╕Ъ id р╕Др╣Ир╕▓р╣Ар╕Зр╕┤р╕Щ
		$status=select(1,$table,"status");	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓ status
		$lap=select(1,$table,"NET");	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕гр╕нр╕Ър╕Чр╕╡р╣И
		$admin=select($id,$table,"admin"); //р╕гр╕▒р╕Ър╕Др╣Ир╕▓ admin
		$sarop=select(1,$table,"admin");	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕зр╣Ир╕▓р╕кр╕гр╕╕р╕Ыр╕вр╕▒р╕З
		$poll=select(1,$table,'LineID');		//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Ьр╕ер╕Бр╕▓р╕гр╕кр╕гр╕╕р╕Ы
		$net=select($netid,'money','NET');	//р╕гр╕▒р╕Ър╕Др╣Ир╕▓р╣Ар╕Зр╕┤р╕Щр╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И
		$arr=str_split($text);						//р╣Бр╕вр╕Бр╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕бр╕▓р╕Чр╕╡р╕ер╕░р╕Хр╕▒р╕зр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щ arr
		$arr1=explode('-',$text);
		
		if(($arr[0]=="t"||$arr[0]=="T"||$arr[0]=="d"||$arr[0]=="D"||$arr1[0]=="td"||$arr1[0]=="Td")&&$status==1&&$id==0){
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕Бр╕гр╕╕р╕Ур╕▓р╕Юр╕┤р╕б play";
		}
		//р╕Вр╕╢р╣Йр╕Щр╕Фр╣Йр╕зр╕в t р╕Др╕╖р╕нр╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕Чр╕З
		elseif(($arr[0]=="t"||$arr[0]=="T"||$arr[0]=="d"||$arr[0]=="D"||$arr1[0]=="td"||$arr1[0]=="Td")&&$status==1){
			$var=explode('-',$text);
			//р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Гр╕лр╣Йр╕Ър╕нр╕Чр╣Бр╕Ир╣Йр╕Зр╕Чр╕╕р╕Бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б р╕зр╣Ир╕▓р╣Гр╕лр╣Йр╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕Бр╣Ир╕нр╕Щ
			if($net>=$var[1]+sum($id,$table)){
				$ans=updatedragontiger($id,$text);
				if($ans==1){
					$replytext='тЭМр╕Др╕╕р╕У '.$res['displayName']." р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕Чр╕Зр╕Ьр╕┤р╕ФтЭМ";
				}
				else{
					$replytext=check($id);
				}
			}
			else{
				$replytext='тЭМр╕Др╕╕р╕У '.$res['displayName']." р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╕Юр╕н р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н $net р╕Ър╕▓р╕ЧтЭМ";
			}
		}
		elseif(($arr[0]=="t"||$arr[0]=="T"||$arr[0]=="d"||$arr[0]=="D"||$arr1[0]=="td"||$arr1[0]=="Td")&&$status==0){
			$replytext="тЭМр╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╣Бр╕ер╣Йр╕зтЭМ";
		}
		//р╕Вр╕╢р╣Йр╕Щр╕Фр╣Йр╕зр╕в x р╕Др╕╖р╕нр╕ер╕Ър╕нр╕нр╕Б
		if(($arr[0]=="x"||$arr[0]=="X")&&$status==1){
			$var=substr($text,1);
			$ans=cancledragontiger($id,$var);
			if($ans==1){
				$replytext='р╕Др╕╕р╕У '.$res['displayName']." тЭМр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕Чр╕Зр╕Ьр╕┤р╕ФтЭМ";
			}
			else{
				$replytext=check($id);
			}
		}
		elseif(($arr[0]=="x"||$arr[0]=="X")&&$status==0){
			$replytext="тЭМр╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╣Бр╕ер╣Йр╕зтЭМ";
		}
		//check
		if($text=='check'||$text=='Check'){
			$replytext=check($id);
		}
		//р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕лр╣Й admin
		/*if($status==1){
			conclude();
			$admintext="р╣Ар╕кр╕╖р╕н: ".select(1,$table,'р╣Ар╕кр╕╖р╕н').' р╕бр╕▒р╕Зр╕Бр╕г: '.select(1,$table,'р╕бр╕▒р╕Зр╕Бр╕г').' р╣Ар╕кр╕бр╕н: '.select(1,$table,'р╣Ар╕кр╕бр╕н');
			sendline('Ucb19a6fc85ac19afe4a2247ad4c944f0',$access_token,$admintext);
		}*/
		
		//р╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕Йр╕Юр╕▓р╕░ admin
		if($admin==1){				
			//р╕Цр╣Йр╕▓р╕Юр╕┤р╕бр╕бр╕▓р╕зр╣Ир╕▓ р╕Ыр╕гр╕▒р╕Ъ р╣Гр╕лр╣Йр╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕Кр╕╖р╣Ир╕нр╕Чр╕╕р╕Бр╕Др╕Щ
			if($text=="р╕Ыр╕гр╕▒р╕Ъ"){								
				config($access_token,$groupid,$table);
				$replytext="р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕Кр╕╖р╣Ир╕нр╕кр╕│р╣Ар╕гр╣Зр╕И";
			}
			//р╣Ар╕Ыр╕┤р╕Фр╕гр╕нр╕Ъ р╣Гр╕Кр╣Йр╕Кр╣Ир╕нр╕З net р╣Ар╕Ыр╣Зр╕Щр╕Кр╣Ир╕нр╕Зр╕Щр╕▒р╕Ър╕гр╕нр╕Ъ
			if($type=="sticker"&&$status==0){
				if($sarop==0){
					$manymessage=2;
					update(1,$table,"status",1);
					update(1,$table,"admin",1);
					$replytext1='ЁЯО▓ЁЯО▓р╕Бр╕Хр╕┤р╕Бр╕▓р╣Ар╕кр╕╖р╕нр╕бр╕▒р╕Зр╕Бр╕гЁЯО▓ЁЯО▓
┬оя╕Пр╕Юр╕┤р╕бр╕Юр╣М play р╣Ар╕Юр╕╖р╣Ир╕нр╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕Бр╣Ир╕нр╕Щ
р╕Юр╕┤р╕бр╕Юр╣М T р╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ир╕░р╣Ар╕ер╣Ир╕Щр╕Хр╣Ир╕нр╕Фр╣Йр╕зр╕вр╕Вр╕╡р╕Ф (-) р╣Бр╕ер╣Йр╕зр╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ р╣Ар╕Кр╣Ир╕Щ t1-200
р╕Юр╕┤р╕бр╕Юр╣М X р╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕гр╕лр╕▒р╕кр╕Хр╕▒р╕зр╕Чр╕╡р╣И тЭМр╣Др╕бр╣ИтЭМ р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ир╕░р╣Ар╕ер╣Ир╕Щр╣Ар╕Юр╕┤р╣Ир╕бр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
тЩая╕ПтЩея╕Пр╕зр╕┤р╕Шр╕╡р╕Щр╕▒р╕Ър╣Бр╕Хр╣Йр╕бтЩжя╕ПтЩгя╕П
тЭЧр╕зр╕▒р╕Фр╕Ьр╕ер╣Ар╕Юр╕╡р╕вр╕Зр╣Бр╕Хр╣Йр╕бр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ р╣Др╕бр╣Ир╕Щр╕│р╕Фр╕нр╕Бр╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╕нр╕З р╣Вр╕Фр╕вр╣Др╕Юр╣Ир╕Чр╕╡р╣Ир╣Бр╕Хр╣Йр╕бр╕Хр╣Ир╕│р╕кр╕╕р╕Фр╕Др╕╖р╕н A р╣Бр╕ер╕░р╣Бр╕Хр╣Йр╕бр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╕Др╕╖р╕н KтЭЧ
ЁЯУМр╣Бр╕Чр╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╣Др╕Фр╣Йр╣Ар╕гр╕╖р╣Ир╕нр╕вр╣Жр╕Ир╕Щр╕Бр╕зр╣Ир╕▓р╕Ир╕░р╕Ир╕Ър╕гр╕нр╕ЪЁЯУМ
t=р╣Ар╕кр╕╖р╕нЁЯРп 1 р╕Хр╣Ир╕н
t1=р╕Др╕╡р╣Ир╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нтШШя╕ПЁЯРп 0.9 р╕Хр╣Ир╕н
t2=р╕Др╕╣р╣Ир╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нЁЯНАЁЯРп 0.9 р╕Хр╣Ир╕н
tb=р╕Фр╕│р╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нтЪлЁЯРп 0.9 р╕Хр╣Ир╕н
tr=р╣Бр╕Фр╕Зр╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нЁЯФ┤ЁЯРп 0.9 р╕Хр╣Ир╕н
d=р╕бр╕▒р╕Зр╕Бр╕гЁЯРЙ 1  р╕Хр╣Ир╕н
d1=р╕Др╕╡р╣Ир╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гтШШя╕ПЁЯРЙ 0.9 р╕Хр╣Ир╕н
d2=р╕Др╕╣р╣Ир╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гЁЯНАЁЯРЙ 0.9 р╕Хр╣Ир╕н
db=р╕Фр╕│р╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гтЪлЁЯРЙ 0.9 р╕Хр╣Ир╕н
dr=р╣Бр╕Фр╕Зр╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гЁЯФ┤ЁЯРЙ 0.9 р╕Хр╣Ир╕н
td=р╣Ар╕кр╕бр╕нтЪЦя╕П 8 р╕Хр╣Ир╕н';
					$replytext2="р╣Ар╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╕Чр╕╡р╣И ".$lap;
				}
				else{
					$replytext='тЭМр╕Бр╕гр╕╕р╕Ур╕▓р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Бр╣Ир╕нр╕ЩтЭМ';
				}
			}
			//р╕Ыр╕┤р╕Фр╕гр╕нр╕Ъ
			if($type=="sticker"&&$status==1){
				$manymessage=2;
				update(1,$table,"status",0);
				$replytext1='ЁЯО▓ЁЯО▓р╕Бр╕Хр╕┤р╕Бр╕▓р╣Ар╕кр╕╖р╕нр╕бр╕▒р╕Зр╕Бр╕гЁЯО▓ЁЯО▓
┬оя╕Пр╕Юр╕┤р╕бр╕Юр╣М play р╣Ар╕Юр╕╖р╣Ир╕нр╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕Бр╣Ир╕нр╕Щ
р╕Юр╕┤р╕бр╕Юр╣М T р╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ир╕░р╣Ар╕ер╣Ир╕Щр╕Хр╣Ир╕нр╕Фр╣Йр╕зр╕вр╕Вр╕╡р╕Ф (-) р╣Бр╕ер╣Йр╕зр╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ р╣Ар╕Кр╣Ир╕Щ t1-200
р╕Юр╕┤р╕бр╕Юр╣М X р╕Хр╕▓р╕бр╕Фр╣Йр╕зр╕вр╕гр╕лр╕▒р╕кр╕Хр╕▒р╕зр╕Чр╕╡р╣И тЭМр╣Др╕бр╣ИтЭМ р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ир╕░р╣Ар╕ер╣Ир╕Щр╣Ар╕Юр╕┤р╣Ир╕бр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
тЩая╕ПтЩея╕Пр╕зр╕┤р╕Шр╕╡р╕Щр╕▒р╕Ър╣Бр╕Хр╣Йр╕бтЩжя╕ПтЩгя╕П
тЭЧр╕зр╕▒р╕Фр╕Ьр╕ер╣Ар╕Юр╕╡р╕вр╕Зр╣Бр╕Хр╣Йр╕бр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ р╣Др╕бр╣Ир╕Щр╕│р╕Фр╕нр╕Бр╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╕нр╕З р╣Вр╕Фр╕вр╣Др╕Юр╣Ир╕Чр╕╡р╣Ир╣Бр╕Хр╣Йр╕бр╕Хр╣Ир╕│р╕кр╕╕р╕Фр╕Др╕╖р╕н A р╣Бр╕ер╕░р╣Бр╕Хр╣Йр╕бр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╕Др╕╖р╕н KтЭЧ
ЁЯУМр╣Бр╕Чр╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╣Др╕Фр╣Йр╣Ар╕гр╕╖р╣Ир╕нр╕вр╣Жр╕Ир╕Щр╕Бр╕зр╣Ир╕▓р╕Ир╕░р╕Ир╕Ър╕гр╕нр╕ЪЁЯУМ
t=р╣Ар╕кр╕╖р╕нЁЯРп 1 р╕Хр╣Ир╕н
t1=р╕Др╕╡р╣Ир╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нтШШя╕ПЁЯРп 0.75 р╕Хр╣Ир╕н
t2=р╕Др╕╣р╣Ир╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нЁЯНАЁЯРп 1.05 р╕Хр╣Ир╕н
tb=р╕Фр╕│р╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нтЪлЁЯРп 0.9 р╕Хр╣Ир╕н
tr=р╣Бр╕Фр╕Зр╕Эр╕▒р╣Ир╕Зр╣Ар╕кр╕╖р╕нЁЯФ┤ЁЯРп 0.9 р╕Хр╣Ир╕н
d=р╕бр╕▒р╕Зр╕Бр╕гЁЯРЙ 1  р╕Хр╣Ир╕н
d1=р╕Др╕╡р╣Ир╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гтШШя╕ПЁЯРЙ 0.75 р╕Хр╣Ир╕н
d2=р╕Др╕╣р╣Ир╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гЁЯНАЁЯРЙ 1.05 р╕Хр╣Ир╕н
db=р╕Фр╕│р╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гтЪлЁЯРЙ 0.9 р╕Хр╣Ир╕н
dr=р╣Бр╕Фр╕Зр╕Эр╕▒р╣Ир╕Зр╕бр╕▒р╕Зр╕Бр╕гЁЯФ┤ЁЯРЙ 0.9 р╕Хр╣Ир╕н
td=р╣Ар╕кр╕бр╕нтЪЦя╕П 8 р╕Хр╣Ир╕н';
				$replytext2="р╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╕Чр╕╡р╣И ".$lap;
				update(1,$table,'admin',1);
			}
			//р╣Ар╕Лр╣Зр╕Хр╕гр╕нр╕Ър╣Бр╕гр╕Б
			if($text=="op"||$text=="Op"){
				update(1,$table,"status",0);
				update(1,$table,"NET",1);
				update(1,$table,'admin',0);
				$replytext="р╣Ар╕Хр╕гр╕╡р╕вр╕бр╣Ар╕гр╕┤р╣Ир╕бр╕гр╕нр╕Ър╣Бр╕гр╕Б";
			}
			
			//check р╕Ьр╕е
			if(($arr[0]=="s"||$arr[0]=="S")&&$status==0){
				$var1=substr($text,1);
				$var=explode(',',$var1);
				$tfront=substr($var[0],0,1);
				$nfront=substr($var[0],1);
				$tback=substr($var[1],0,1);
				$nback=substr($var[1],1);
				if($tfront==1){
					$tfront='р╕Фр╕│тЪл';
				}
				elseif($tfront==2){
					$tfront='р╣Бр╕Фр╕ЗЁЯФ┤';
				}
				if($tback==1){
					$tback='р╕Фр╕│тЪл';
				}
				elseif($tback==2){
					$tback='р╣Бр╕Фр╕ЗЁЯФ┤';
				}
				$replytext="р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕кр╕гр╕╕р╕Ы
ЁЯРпр╣Ар╕кр╕╖р╕нр╣Бр╕Хр╣Йр╕б $nfront р╕кр╕╡ $tfront
ЁЯРЙр╕бр╕▒р╕Зр╕Бр╕гр╣Бр╕Хр╣Йр╕б $nback р╕кр╕╡ $tback
р╕лр╕гр╕╖р╕нр╣Др╕бр╣ИтЭУ";
				update(1,$table,'LineID',$var1);
			}
			elseif(($arr[0]=="s"||$arr[0]=="S")&&$status==1){
				$replytext='тЭМр╕Бр╕гр╕╕р╕Ур╕▓р╕Ыр╕┤р╕Фр╕гр╕нр╕Ър╕Бр╣Ир╕нр╕ЩтЭМ';
			}
			if($text=='@ok'&&$poll!=0){
				update($id,$table,'NET',$net);
				$replytext=resultdragontiger($poll);
				update(1,$table,'LineID',0);
				update(1,$table,'NET',$lap+1);
				update(1,$table,'admin',0);
			}
			elseif($text=='@ok'&&$poll==0){
				$replytext='тЭМр╕кр╕гр╕╕р╕Ыр╕Ьр╕┤р╕Ф р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╕гр╕╕р╕Ыр╣Гр╕лр╕бр╣ИтЭМ';
			}
		}
		//р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щ
		if(($text=="play"||$text=='Play')&&$id==0){
			$var=codename($res['displayName']);
			insert($table,$var,$lineid,0);
			if($netid==0){
				insert('money',$var,$lineid,1000);
			}
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Бр╕ер╣Йр╕з";
		}
		//р╕Цр╣Йр╕▓р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Бр╕ер╣Йр╕зр╕Бр╣Зр╣Гр╕лр╣Йр╕Ър╕нр╕Бр╕зр╣Ир╕▓р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕ер╣Ир╕Щ
		elseif(($text=="play"||$text=='Play')&&$id!=0){
			$replytext="р╕Др╕╕р╕У ".$res['displayName']." р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕ер╣Ир╕Щр╣Бр╕ер╣Йр╕з";
		}
		//р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$messages = [
			[
			'type' => 'text',
			'text' => $replytext
			]
		];
		if($manymessage==2){
			$messages = [
				[
				'type' => 'text',
				'text' => $replytext1
				],
				[
				'type' => 'text',
				'text' => $replytext2
				]
			];
		}
		$url = 'https://api.line.me/v2/bot/message/reply';		//url р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$data = [
			'replyToken' => $replyToken,				//replayToken р╣Гр╕кр╣Ир╕Хр╕гр╕Зр╕Щр╕╡р╣Й
			'messages' => $messages,
		];
		$post = json_encode($data);						//web р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$headers = array('Content-Type: application/json', 'Authorization: Bearer ' . $access_token);
														//headers р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
		$ch = curl_init($url);							//р╣Ар╕гр╕┤р╣Ир╕б curl 
		curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");//р╕Ыр╕гр╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ъ post
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);	
		curl_setopt($ch, CURLOPT_POSTFIELDS, $post);	//р╣Гр╕кр╣Ир╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕Ир╕░р╕кр╣Ир╕З
		curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);	//р╕кр╣Ир╕З header
		curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);	
		curl_exec($ch);									//р╕кр╣Ир╕Зр╣Др╕Ыр╣Гр╕лр╣Йр╣Др╕ер╕Щр╣Мр╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
	}
}
